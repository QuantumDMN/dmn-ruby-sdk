openapi: 3.0.0
info:
  title: Go DMN Web API
  version: 1.0.0
  description: API for the Go DMN Web application.

# servers:
#   - url: /api/v1
#     description: V1

paths:
  /health:
    get:
      summary: Health Check
      operationId: GetHealth
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
  
  /overview:
    get:
      summary: Get Overview Dashboard Data
      operationId: GetOverview
      description: Returns aggregated statistics for the overview dashboard including KPI charts and quota status.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OverviewResponse'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /version:
    get:
      summary: Version
      operationId: GetVersion
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    example: "1.0.0"
                  build_time:
                    type: string
                    example: "2023-10-27T10:00:00Z"
                  commit:
                    type: string
                    example: "abcdef123"

  /config:
    get:
      summary: Get Frontend Configuration
      operationId: GetFrontendConfig
      description: Returns configuration required by the frontend application (OIDC settings)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FrontendConfig'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  /settings:
    patch:
      summary: Update Customer Settings
      operationId: UpdateCustomerSettings
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                allowOverage:
                  type: boolean
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /users:
    get:
      summary: List Organization Users
      operationId: ListUsers
      parameters:
        - name: search
          in: query
          required: false
          schema:
            type: string
          description: Search by email or username
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrganizationUser'
        '500':
          $ref: '#/components/responses/InternalError'

  /users/batch:
    post:
      summary: Batch Get Organization Users
      operationId: BatchGetUsers
      description: Retrieve multiple users by their IDs. Available to all authenticated organization members.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_ids
              properties:
                user_ids:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrganizationUser'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /subscription/portal-session:
    get:
      summary: Get Customer Portal Session
      operationId: GetCustomerPortalSession
      description: Returns a generated link to the Paddle Customer Portal
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
        '403':
          description: Forbidden (No subscription)
        '500':
          $ref: '#/components/responses/InternalError'

  /billing/upgrade-transaction:
    post:
      summary: Create Subscription Upgrade Transaction
      operationId: CreateSubscriptionUpgradeTransaction
      description: Creates a Paddle transaction to upgrade/downgrade the current subscription
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - priceId
              properties:
                priceId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  transactionId:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: No active subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalError'

  /permissions:
    get:
      summary: Get User Permissions
      operationId: GetUserPermissions
      description: Returns the current user's global role and all project-level permissions
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPermissions'
        '500':
          $ref: '#/components/responses/InternalError'

  /evaluate/design:
    post:
      summary: Evaluate DMN Design
      operationId: EvaluateDesign
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - xml
              properties:
                xml:
                  type: string
                context:
                  $ref: '#/components/schemas/FeelContext'
                decisionServices:
                  type: array
                  items:
                    type: string
                  description: Names of the Decision Services to evaluate (optional)
                decisions:
                  type: array
                  items:
                    type: string
                  description: List of Decision or Decision Service names to evaluate (optional)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/EvaluationResult'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  
  /projects/{projectID}/definitions/{definitionID}/evaluate:
    post:
      summary: Evaluate Stored Definition
      operationId: EvaluateStored
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluateStoredRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/EvaluationResult'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /evaluate/design/batch:
    post:
      summary: Batch evaluate a DMN design with multiple inputs
      operationId: EvaluateDesignBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchEvaluateDesignRequest'
      responses:
        '200':
          description: Batch evaluation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchEvaluationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
  /projects:
    get:
      summary: List Projects
      operationId: ListProjects
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create Project
      operationId: CreateProject
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}:
    get:
      summary: Get Project
      operationId: GetProject
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete Project
      operationId: DeleteProject
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: No Content
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  /projects/{projectID}/members:
    get:
      summary: List Project Members
      operationId: ListProjectMembers
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectMember'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Add Project Member
      operationId: AddProjectMember
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddProjectMemberRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMember'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /projects/{projectID}/members/{userID}:
    put:
      summary: Update Project Member Role
      operationId: UpdateProjectMemberRole
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userID
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProjectMemberRoleRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMember'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Remove Project Member
      operationId: RemoveProjectMember
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: userID
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'


  /projects/{projectID}/definitions:
    get:
      summary: List Definitions
      operationId: ListDefinitions
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number (1-indexed)
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of items per page (max 100)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedDefinitionsResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create Definition
      operationId: CreateDefinition
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDefinitionRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Definition'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/definitions/latest:
    get:
      summary: List Latest Definitions (one per definition_id)
      operationId: ListLatestDefinitions
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number (1-indexed)
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of items per page (max 100)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedDefinitionsResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/definitions/by-xml-id/{xmlDefinitionID}:
    get:
      summary: Get definition by XML definition ID
      description: Get the latest version of a definition by its XML definition ID, or a specific version if provided
      operationId: GetDefinitionByXMLID
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: xmlDefinitionID
          in: path
          required: true
          schema:
            type: string
          description: The XML definition ID from the DMN model
        - name: version
          in: query
          required: false
          schema:
            type: integer
          description: Specific version number (defaults to latest version)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Definition'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/definitions/by-xml-id/{xmlDefinitionID}/evaluate:
    post:
      summary: Evaluate definition by XML definition ID
      description: Evaluate a decision using XML definition ID (uses latest version unless version parameter specified)
      operationId: EvaluateByXMLID
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: xmlDefinitionID
          in: path
          required: true
          schema:
            type: string
          description: The XML definition ID from the DMN model
        - name: version
          in: query
          required: false
          schema:
            type: integer
          description: Specific version number (defaults to latest version)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluateStoredRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/EvaluationResult'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/definitions/by-definition-id/{definitionId}:
    get:
      summary: List all versions of a specific definition_id
      operationId: ListDefinitionVersions
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionId
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number (1-indexed)
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of items per page (max 100)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedDefinitionsResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/definitions/{definitionID}:
    get:
      summary: Get Definition
      operationId: GetDefinition
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Definition'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Update Definition
      operationId: UpdateDefinition
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDefinitionRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Definition'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete Definition
      operationId: DeleteDefinition
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: No Content
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  /projects/{projectID}/definitions/{definitionID}/simulate:
    post:
      summary: Run Simulation on Historical Data
      operationId: RunSimulation
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SimulationRequest'
      responses:
        '200':
          description: Simulation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimulationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalError'

  /projects/{projectID}/definitions/{definitionID}/executions:
    get:
      summary: List Executions for Definition
      operationId: ListExecutions
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: definitionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: xmlDefinitionId
          in: query
          required: false
          schema:
            type: string
          description: Filter by XML Definition ID
        - name: start_date
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Filter executions after this date (ISO 8601)
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number (1-indexed)
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of items per page (max 100)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedExecutionsResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/executions:
    get:
      summary: List All Executions for Project
      operationId: ListProjectExecutions
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: xmlDefinitionId
          in: query
          required: false
          schema:
            type: string
          description: Filter by XML Definition ID
        - name: page
          in: query
          required: false
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number (1-indexed)
        - name: pageSize
          in: query
          required: false
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of items per page (max 100)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedExecutionsResponse'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /projects/{projectID}/executions/{executionID}:
    get:
      summary: Get Execution
      operationId: GetExecution
      parameters:
        - name: projectID
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: executionID
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Execution'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /limits:
    get:
      summary: Get Quota Limits
      operationId: GetLimits
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Quota'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
           $ref: '#/components/responses/InternalError'

  /tiers:
    get:
      summary: List Tiers
      operationId: ListTiers
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tier'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /tiers/{tierID}:
    get:
      summary: Get Tier
      operationId: GetTier
      parameters:
        - name: tierID
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tier'
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    FrontendConfig:
      type: object
      required:
        - oidc
      properties:
        oidc:
          type: object
          required:
            - authority
            - clientId
          properties:
            authority:
              type: string
              description: OIDC authority URL (issuer)
              example: "http://localhost:8080"
            clientId:
              type: string
              description: OIDC client ID for the web application
              example: "123456789@dmn-engine"
        paddle:
          type: object
          properties:
            clientToken:
              type: string
              description: Paddle client-side token for checkout
              example: "test_..."
            sandbox:
              type: boolean
              description: Whether to use Paddle sandbox environment
              example: true

    BatchEvaluateDesignRequest:
      type: object
      properties:
        xml:
          type: string
          description: The DMN XML definition to evaluate
        inputs:
          type: array
          description: List of input contexts (rows) to evaluate
          items:
             type: object
             additionalProperties: true

    BatchEvaluationResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            properties:
              executionId:
                type: string
              inputs:
                type: object
                additionalProperties: true
              results:
                 type: object
                 additionalProperties:
                   $ref: '#/components/schemas/EvaluationResult'

    Error:
      type: object
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string

    Project:
      type: object
      required:
        - id
        - name
        - customer_id
        - schema_name
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        customer_id:
          type: string
          format: uuid
        schema_name:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateProjectRequest:
      type: object
      required:
        - name
        - customer_id
      properties:
        name:
          type: string
        customer_id:
          type: string
          format: uuid

    Definition:
      type: object
      required:
        - id
        - name
        - definition_id
        - xml
        - version
        - created_at
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        definition_id:
          type: string
        xml:
          type: string
        version:
          type: integer
        created_by:
          type: string
        created_at:
          type: string
          format: date-time

    CreateDefinitionRequest:
      type: object
      required:
        - name
        - xml
      properties:
        name:
          type: string
        xml:
          type: string
        version:
          type: integer

    UpdateDefinitionRequest:
      type: object
      properties:
        xml:
          type: string
        version:
          type: integer
        name:
          type: string


    EvaluateStoredRequest:
      type: object
      required:
        - context
      properties:
        version:
          type: integer
        context:
          $ref: '#/components/schemas/FeelContext'
        decisionServices:
          type: array
          items:
            type: string
          description: List of Decision Services to evaluate
        decisions:
          type: array
          items:
            type: string
          description: List of Decision or Decision Service names to evaluate

    SimulationRequest:
      type: object
      required:
        - xml
      properties:
        xml:
          type: string
          description: The DMN XML definition to use for simulation
        startDate:
          type: string
          format: date-time
          description: Filter historical executions after this date (ISO 8601). If not provided, defaults to 24h.

    SimulationResponse:
      type: object
      properties:
        results:
          type: array
          items:
            type: object
            properties:
              executionId:
                type: string
              executedAt:
                 type: string
                 format: date-time
              inputs:
                type: object
                additionalProperties: true
              results:
                 type: object
                 additionalProperties:
                   $ref: '#/components/schemas/EvaluationResult'

    FeelValue:
      oneOf:
        - $ref: '#/components/schemas/FeelNumber'
        - $ref: '#/components/schemas/FeelString'
        - $ref: '#/components/schemas/FeelBoolean'
        - $ref: '#/components/schemas/FeelList'
        - $ref: '#/components/schemas/FeelContext'
      nullable: true

    FeelNumber:
      type: number
      description: "FEEL number (decimal)"

    FeelString:
      type: string
      description: "FEEL string, date, time, duration, etc."

    FeelBoolean:
      type: boolean
      description: "FEEL boolean"

    FeelList:
      type: array
      items:
        $ref: '#/components/schemas/FeelValue'

    FeelContext:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/FeelValue'

    Execution:
      type: object
      required:
        - id
        - definition_id
        - executed_at
        - inputs
        - outputs
      properties:
        id:
          type: string
          format: uuid
        definition_id:
          type: string
          format: uuid
        executed_at:
          type: string
          format: date-time
        executed_by:
          type: string
        inputs:
          $ref: '#/components/schemas/FeelContext'
        outputs:
          $ref: '#/components/schemas/FeelValue'
        xml_definition_id:
          type: string


    Tier:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
        name:
          type: string
        price:
          type: number
        features:
          $ref: '#/components/schemas/TierFeaturesConfig'
        paddlePriceId:
          type: string

    TierFeaturesConfig:
      type: object
      properties:
        credits:
          type: integer
        overchargePricePer100Credits:
          type: integer
        limits:
          $ref: '#/components/schemas/TierLimits'
        features:
          $ref: '#/components/schemas/FeatureFlags'

    TierLimits:
      type: object
      properties:
        projects:
          type: integer
        seats:
          type: integer
        definitionsPerProject:
          type: integer
        historyRetentionDays:
          type: integer

    FeatureFlags:
      type: object
      additionalProperties:
        type: boolean

    EvaluationResult:
      type: object
      properties:
        decisionId:
          type: string
        name:
          type: string
        error:
          type: string
          nullable: true
        type:
          type: string
          enum: [DECISION, KPI, DECISION_SERVICE, BKM, INPUT_DATA]
        value:
          $ref: '#/components/schemas/FeelValue'
        hitRules:
          type: array
          items:
             $ref: '#/components/schemas/HitRule'
        dependencies:
          type: array
          items:
             $ref: '#/components/schemas/EvaluationResult'

    HitRule:
       type: object
       properties:
          ruleID:
             type: string
          outputs:
             $ref: '#/components/schemas/FeelValue'

    PaginationMetadata:
      type: object
      required:
        - page
        - pageSize
        - total
        - totalPages
      properties:
        page:
          type: integer
          description: Current page number (1-indexed)
        pageSize:
          type: integer
          description: Number of items per page
        total:
          type: integer
          description: Total number of items
        totalPages:
          type: integer
          description: Total number of pages

    PaginatedDefinitionsResponse:
      type: object
      required:
        - data
        - pagination
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Definition'
        pagination:
          $ref: '#/components/schemas/PaginationMetadata'

    OverviewResponse:
      type: object
      properties:
        stats:
          type: object
          properties:
            totalRequests:
              type: integer
            totalCredits:
              type: integer
            requestsTrend:
              type: array
              items:
                $ref: '#/components/schemas/DailyStat'
            creditsTrend:
               type: array
               items:
                 $ref: '#/components/schemas/DailyStat'
            kpiTrends:
               type: array
               items:
                 $ref: '#/components/schemas/KpiTrend'

    Quota:
      type: object
      required:
        - tierId
      properties:
        tierId:
          type: string
          description: The ID of the current tier (e.g., developer, starter, scale)
        credits:
          $ref: '#/components/schemas/CreditsQuota'
        history:
          $ref: '#/components/schemas/QuotaItem'
        projects:
          $ref: '#/components/schemas/QuotaItem'
        definitions:
          $ref: '#/components/schemas/DefinitionsQuota'
        users:
          $ref: '#/components/schemas/QuotaItem'

    CreditsQuota:
      allOf:
        - $ref: '#/components/schemas/QuotaItem'
        - type: object
          properties:
            overchargePrice:
              type: integer
            overchargeEnabled:
              type: boolean

    DefinitionsQuota:
      type: object
      properties:
        limit:
          type: integer
          description: Max definitions allowed per project (tier limit)
        projects:
          type: array
          items:
            $ref: '#/components/schemas/ProjectUsage'

    ProjectUsage:
      type: object
      properties:
        projectId:
          type: string
          format: uuid
        name:
          type: string
        usage:
          type: integer
        limit:
          type: integer

    QuotaItem:
      type: object
      properties:
        used:
          type: integer
        limit:
          type: integer

    DailyStat:
       type: object
       properties:
         date:
           type: string
           format: date
         requests:
             type: integer
         credits:
             type: integer

    KpiTrend:
      type: object
      properties:
        kpiId:
          type: string
        name:
          type: string
        data:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date-time
              value:
                type: number

    PaginatedExecutionsResponse:
      type: object
      required:
        - data
        - pagination
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Execution'
        pagination:
          $ref: '#/components/schemas/PaginationMetadata'

    OrganizationUser:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        username:
          type: string

    ProjectMember:
      type: object
      properties:
        project_id:
          type: string
          format: uuid
        user_id:
          type: string
        role:
          type: string
        username:
          type: string
        email:
          type: string
        created_at:
          type: string
          format: date-time

    AddProjectMemberRequest:
      type: object
      required:
        - userID
        - role
      properties:
        userID:
          type: string
        role:
          type: string

    UpdateProjectMemberRoleRequest:
      type: object
      required:
        - role
      properties:
        role:
          type: string

    UserPermissions:
      type: object
      required:
        - global_role
        - projects
      properties:
        global_role:
          type: string
          description: User's global organization role (admin or user)
        projects:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ProjectPermissions'
          description: Map of projectID to project permissions

    ProjectPermissions:
      type: object
      required:
        - role
        - can_manage_members
        - can_edit_definitions
        - can_execute
        - can_view
      properties:
        role:
          type: string
          description: Project role (admin, editor, executor, viewer)
        can_manage_members:
          type: boolean
        can_edit_definitions:
          type: boolean
        can_execute:
          type: boolean
        can_view:
          type: boolean

  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
         application/json:
           schema:
             $ref: '#/components/schemas/Error'
    InternalError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'


